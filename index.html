<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è –∏–ø–æ—Ç–µ–∫–∏ ‚Äî –ò–Ω–≥–æ—Å—Å—Ç—Ä–∞—Ö</title>
  <meta name="description" content="–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è –∏–ø–æ—Ç–µ–∫–∏ –æ–Ω–ª–∞–π–Ω. –ë—ã—Å—Ç—Ä—ã–π –∏ —Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.">

  <link rel="stylesheet" href="style.css?v=4">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

  <!-- Puter API –¥–ª—è Grok -->
  <script src="https://js.puter.com/v2/"></script>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ -->
  <script defer src="config_banks.js?v=4"></script>
  <script defer src="tariffs_life.js?v=4"></script>
  <script defer src="tariffs_property.js?v=4"></script>

  <!-- –õ–æ–≥–∏–∫–∞ -->
  <script defer src="parser.js?v=4"></script>
  <script defer src="calculator_v2.js?v=4"></script>

  <!-- UI -->
  <script defer src="ui-adapter.js?v=4"></script>
  <script defer src="openai.js?v=4"></script>
</head>

<body>
  <!-- –®–∞–ø–∫–∞ -->
  <header class="header">
    <div class="header__container">
      <div class="header__title">
        <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è –∏–ø–æ—Ç–µ–∫–∏</h1>
      </div>
    </div>
  </header>

  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
  <main class="main">
    <div class="container">

      <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
      <nav class="nav">
        <div class="nav__steps">
          <div class="nav__step nav__step--active">
            <span class="nav__step-number">1</span>
            <span class="nav__step-text">–†–∞—Å—á–µ—Ç</span>
          </div>
          <div class="nav__step">
            <span class="nav__step-number">2</span>
            <span class="nav__step-text">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</span>
          </div>
          <div class="nav__step">
            <span class="nav__step-number">3</span>
            <span class="nav__step-text">–û–ø–ª–∞—Ç–∞</span>
          </div>
        </div>
      </nav>

      <!-- –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä -->
      <div class="calculator">

        <!-- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ -->
        <div class="calculator__form">
          <h2 class="calculator__title">–†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è</h2>

          <div class="form__group">
            <label for="input-area" class="form__label">–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞</label>
            <textarea
              id="input-area"
              class="form__textarea"
              placeholder="–ü—Ä–∏–º–µ—Ä: –í–¢–ë –æ—Å—Ç 5103175 –º—É–∂ 15.08.1965 —Å—Ç 10 –∫–¥ 23.11.2020 –∂–∏–∑–Ω—å"
              rows="4"
            ></textarea>
            <div class="form__hint">
              –í–≤–µ–¥–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–∞–Ω–∫–µ, —Å—É–º–º–µ –æ—Å—Ç–∞—Ç–∫–∞, –∑–∞–µ–º—â–∏–∫–µ –∏ —Ç–∏–ø–µ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è
            </div>
          </div>

          <button id="calculate-btn" class="btn btn--primary btn--large">
            –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å
          </button>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
        <div id="results-section" class="calculator__results" style="display: none;">
          <h3 class="results__title">–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á–µ—Ç–∞</h3>

          <div class="results__summary">
            <div class="summary__item">
              <span class="summary__label">–ë–∞–Ω–∫-–∫—Ä–µ–¥–∏—Ç–æ—Ä</span>
              <span id="result-bank" class="summary__value">-</span>
            </div>
            <div class="summary__item">
              <span class="summary__label">–û—Å—Ç–∞—Ç–æ–∫ –ø–æ –∏–ø–æ—Ç–µ–∫–µ</span>
              <span id="result-amount" class="summary__value">-</span>
            </div>
            <div class="summary__item">
              <span class="summary__label">–ß—Ç–æ –±—É–¥–µ—Ç –∑–∞—Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–æ</span>
              <span id="result-risks" class="summary__value">-</span>
            </div>
            <div class="summary__item summary__item--total">
              <span class="summary__label">–°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–ª–∏—Å–∞</span>
              <span id="result-total" class="summary__value summary__value--total">-</span>
            </div>
          </div>

          <div id="detailed-results" class="results__details">
            <!-- –ü–æ–¥—Ä–æ–±–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω—ã —Å—é–¥–∞ -->
          </div>
        </div>

      </div>

      <!-- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è -->
      <section class="examples">
        <h3 class="examples__title">–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤</h3>
        <div class="examples__grid">
          <div class="example__item">
            <h4>–¢–æ–ª—å–∫–æ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∂–∏–∑–Ω–∏</h4>
            <code>–í–¢–ë –æ—Å—Ç 5103175 –º—É–∂ 15.08.1965 —Å—Ç 10 –∫–¥ 23.11.2020 –∂–∏–∑–Ω—å</code>
          </div>
          <div class="example__item">
            <h4>–ñ–∏–∑–Ω—å –∏ –∏–º—É—â–µ—Å—Ç–≤–æ</h4>
            <code>–°–±–µ—Ä –∂+–∏–º –æ—Å–∑ = 3 232 000 –¥–æ–º 2022 –∫–∏—Ä–ø–∏—á –º—É–∂ 08.08.1989</code>
          </div>
          <div class="example__item">
            <h4>–° –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∑–∞–µ–º—â–∏–∫–∞–º–∏</h4>
            <code>–ê–∫–ë–∞—Ä—Å –æ—Å—Ç 2232907 –æ–Ω 50% 13.04.1968 –æ–Ω–∞ 50% 02.05.1968 –∫–≤-—Ä–∞</code>
          </div>
        </div>
      </section>

      <!-- –ß–∞—Ç —Å Grok AI -->
      <section class="chat-section">
        <div class="chat-container">
          <h3 class="chat__title">üí¨ –ß–∞—Ç —Å –ò–ò Grok</h3>
          <p class="chat__subtitle">–ó–∞–¥–∞–π—Ç–µ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å –æ–± –∏–ø–æ—Ç–µ—á–Ω–æ–º —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–∏ –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</p>

          <div class="chat__window">
            <div id="chat-messages" class="chat__messages">
              <div class="message message--assistant">
                <div class="message__avatar">ü§ñ</div>
                <div class="message__content">
                  <div class="message__text">–ü—Ä–∏–≤–µ—Ç! –Ø Grok - –ò–ò –æ—Ç xAI. –Ø –º–æ–≥—É –ø–æ–º–æ—á—å –≤–∞–º —Å –ª—é–±—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏ –æ–± –∏–ø–æ—Ç–µ—á–Ω–æ–º —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–∏, —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏–ª–∏ –¥–∞—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?</div>
                </div>
              </div>
            </div>

            <div class="chat__input-container">
              <input
                type="text"
                id="chat-input"
                class="chat__input"
                placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å..."
                maxlength="500"
              >
              <button id="chat-send" class="chat__send-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
          </div>

          <div class="chat__suggestions">
            <button class="suggestion-btn" data-text="–ö–∞–∫ –≤—ã–±—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è –∏–ø–æ—Ç–µ–∫–∏?">üí° –°–æ–≤–µ—Ç—ã –ø–æ –≤—ã–±–æ—Ä—É</button>
            <button class="suggestion-btn" data-text="–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω—É–∂–Ω—ã –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∏–ø–æ—Ç–µ—á–Ω–æ–≥–æ —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è?">üìÑ –î–æ–∫—É–º–µ–Ω—Ç—ã</button>
            <button class="suggestion-btn" data-text="–í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ–º –∂–∏–∑–Ω–∏ –∏ –∏–º—É—â–µ—Å—Ç–≤–∞?">‚öñÔ∏è –†–∞–∑–Ω–∏—Ü–∞ —Ä–∏—Å–∫–æ–≤</button>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- –§—É—Ç–µ—Ä -->
  <footer class="footer">
    <div class="footer__container">
      <div class="footer__content">
        <p>¬© 2025 –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏—è –∏–ø–æ—Ç–µ–∫–∏</p>
      </div>
    </div>
  </footer>

  <script>
    // –û–±–Ω–æ–≤–ª—è–µ–º UI –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
    document.addEventListener("DOMContentLoaded", () => {
      const btn = document.getElementById("calculate-btn");
      const input = document.getElementById("input-area");
      const resultsSection = document.getElementById("results-section");
      const resultBank = document.getElementById("result-bank");
      const resultAmount = document.getElementById("result-amount");
      const resultRisks = document.getElementById("result-risks");
      const resultTotal = document.getElementById("result-total");
      const detailedResults = document.getElementById("detailed-results");

      btn.addEventListener("click", async () => {
        const raw = input.value.trim();

        if (raw.length < 5) {
          showError("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞.");
          return;
        }

        try {
          btn.disabled = true;
          btn.textContent = "–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º...";

          const result = handleClientRequest(raw);

          // –ü–∞—Ä—Å–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –Ω–æ–≤–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
          displayResults(result);

        } catch (e) {
          showError("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞: " + e.message);
        } finally {
          btn.disabled = false;
          btn.textContent = "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å";
        }
      });

      function displayResults(htmlResult) {
        // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ HTML —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = htmlResult;

        const bankText = tempDiv.querySelector('b')?.nextSibling?.textContent || '-';
        const amountMatch = htmlResult.match(/–û—Å—Ç–∞—Ç–æ–∫ –¥–æ–ª–≥–∞:\s*([^<]+)/);
        const amount = amountMatch ? amountMatch[1].trim() : '-';

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∏—Å–∫–∏
        let risks = [];
        if (htmlResult.includes('–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∂–∏–∑–Ω–∏')) risks.push('–∂–∏–∑–Ω—å –∏ –∑–¥–æ—Ä–æ–≤—å–µ');
        if (htmlResult.includes('–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –∏–º—É—â–µ—Å—Ç–≤–∞')) risks.push('–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å');
        if (htmlResult.includes('–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ —Ç–∏—Ç—É–ª–∞')) risks.push('—Ç–∏—Ç—É–ª');

        const risksText = risks.join(', ') || '-';

        // –ò—â–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É
        const totalMatch = htmlResult.match(/–ò–¢–û–ì–û —Å—Ç—Ä–∞—Ö–æ–≤–∞—è –ø—Ä–µ–º–∏—è:\s*([^<]+)/);
        const total = totalMatch ? totalMatch[1].trim() : '-';

        // –ó–∞–ø–æ–ª–Ω—è–µ–º summary
        resultBank.textContent = bankText;
        resultAmount.textContent = amount;
        resultRisks.textContent = risksText;
        resultTotal.textContent = total;

        // –ü–æ–¥—Ä–æ–±–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        detailedResults.innerHTML = htmlResult;

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        resultsSection.style.display = 'block';
        resultsSection.scrollIntoView({ behavior: 'smooth' });
      }

      function showError(message) {
        detailedResults.innerHTML = `<div style="color: #e74c3c; padding: 20px; background: #fdf2f2; border-radius: 8px; margin-top: 20px;">${message}</div>`;
        resultsSection.style.display = 'block';
      }

      console.log("–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω");
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞ —Å Grok
    initializeChat();
  </script>

  <script>
    // –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —á–∞—Ç–∞ —Å Grok AI
    let conversationHistory = [];

    function initializeChat() {
      const chatInput = document.getElementById('chat-input');
      const chatSendBtn = document.getElementById('chat-send');
      const chatMessages = document.getElementById('chat-messages');
      const suggestionBtns = document.querySelectorAll('.suggestion-btn');

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
      function sendMessage() {
        const message = chatInput.value.trim();
        if (!message) return;

        addMessage(message, 'user');
        chatInput.value = '';
        chatSendBtn.disabled = true;
        chatSendBtn.textContent = '–ü–µ—á–∞—Ç–∞–µ—Ç...';

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ Grok
        chatWithGrok(message, conversationHistory).then(result => {
          addMessage(result.message, 'assistant');
          conversationHistory = result.conversationHistory;
          chatSendBtn.disabled = false;
          chatSendBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å';
        }).catch(error => {
          addMessage('–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ –ò–ò.', 'assistant');
          chatSendBtn.disabled = false;
          chatSendBtn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å';
          console.error('Chat error:', error);
        });
      }

      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
      function addMessage(text, type) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message message--${type}`;

        const avatar = type === 'user' ? 'üë§' : 'ü§ñ';
        const avatarBg = type === 'user' ? '#0056b3' : '#10a37f';

        messageDiv.innerHTML = `
          <div class="message__avatar" style="background: ${avatarBg}">${avatar}</div>
          <div class="message__content">
            <div class="message__text">${text.replace(/\n/g, '<br>')}</div>
          </div>
        `;

        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      chatSendBtn.addEventListener('click', sendMessage);

      chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          sendMessage();
        }
      });

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–æ–¥—Å–∫–∞–∑–æ–∫
      suggestionBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const text = btn.dataset.text;
          chatInput.value = text;
          sendMessage();
        });
      });

      // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
      addMessage('–ü—Ä–∏–≤–µ—Ç! –Ø Grok - –ò–ò –æ—Ç xAI. –Ø –º–æ–≥—É –ø–æ–º–æ—á—å –≤–∞–º —Å –ª—é–±—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏ –æ–± –∏–ø–æ—Ç–µ—á–Ω–æ–º —Å—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–∏, —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏–ª–∏ –¥–∞—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?', 'assistant');
    }
  </script>
</body>
</html>
